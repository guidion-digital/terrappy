on:
  workflow_call:
  
jobs:
    reviewdog-tf-validate:
      runs-on: ubuntu-latest
      permissions:
        contents: read
        pull-requests: write
      steps:
        - uses: actions/checkout@v4
        - uses: reviewdog/action-terraform-validate@v1
          with:
            reporter: github-pr-review
            fail_on_error: true
            terraform_version: 1.6.5

    reviewdog-tflint:
      needs: reviewdog-tf-validate
      runs-on: ubuntu-latest
      permissions:
        contents: read
        pull-requests: write
      steps:
        - uses: actions/checkout@v4
        - name: Setup Terraform
          uses: hashicorp/setup-terraform@v3
          with:
            terraform_version: 1.6.5

      # Run init to get module code to be able to use `--call-module-type=all`
        - name: Terraform init
          run: terraform init

        - uses: reviewdog/action-tflint@v1
          with:
            reporter: github-pr-review
            fail_on_error: true
            level: warning
            tflint_config: ""
            filter_mode: "nofilter"
            flags: "--call-module-type=all"
